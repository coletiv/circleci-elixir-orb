description: Build and test elixir source code
parameters:
  executor:
    description: Executor to be used in this job
    type: executor
    default: default
  coveralls:
    description: Run tests using excoveralls for code coverage
    default: false
    type: boolean
  dialyzer:
    description: Run dialyzer
    default: false
    type: boolean
  credo:
    description: Run credo
    default: false
    type: boolean
  check-format:
    description: Check code format
    default: false
    type: boolean
  persist-to-workspace:
    default: true
    description: Should this job persist files to a workspace? Defaults to true
    type: boolean
executor: << parameters.executor >>
steps:
  - build
  - when:
      condition: << parameters.check-format >>
      steps:
        - check-format
  - when:
      condition: << parameters.credo >>
      steps:
        - credo
  - when:
      condition: << parameters.coveralls >>
      steps:
        - coveralls
  - unless:
      condition: << parameters.coveralls >>
      steps:
        - test
  - when:
      condition: << parameters.dialyzer >>
      steps:
        - dialyzer
  - when:
      condition: << parameters.persist-to-workspace >>
      steps:
        - persist_to_workspace:
            root: ~/
            paths:
              - project
              - .mix
              - .hex
              - .ssh
